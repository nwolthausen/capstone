---
title: "Capstone -- NDD"
author: "Noah Wolthausen"
date: "2/10/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r }
library(dplyr)
library(plyr)
library(readxl)
library(tidyr)
library(tidyverse)
library(table1)

ndd <- read_excel("/Users/noahwolthausen/Desktop/Capstone/NDD.Master.xlsx")



```
```{r}
#missing values

ndd$cassava[is.na(ndd$cassava)] <- 0
ndd$bread[is.na(ndd$bread)] <- 0
ndd$rice[is.na(ndd$rice)] <- 0
ndd$pasta[is.na(ndd$pasta)] <- 0
ndd$potatoes[is.na(ndd$potatoes)] <- 0
ndd$cereals[is.na(ndd$cereals)] <- 0
ndd$roots_tubers[is.na(ndd$roots_tubers)] <- 0
ndd$beans[is.na(ndd$beans)] <- 0
ndd$eggs[is.na(ndd$eggs)] <- 0
ndd$milk[is.na(ndd$milk)] <- 0
ndd$yogurt[is.na(ndd$yogurt)] <- 0
ndd$chicken...89[is.na(ndd$chicken...89)] <- 0
ndd$flesh_meat[is.na(ndd$flesh_meat)] <- 0
ndd$fish[is.na(ndd$fish)]<- 0
ndd$mango[is.na(ndd$mango)] <- 0
ndd$tomato[is.na(ndd$tomato)] <- 0
ndd$eggplant[is.na(ndd$eggplant)] <- 0
ndd$avocado[is.na(ndd$avocado)] <- 0
ndd$other_fruits[is.na(ndd$other_fruits)] <- 0
ndd$pumpkins[is.na(ndd$pumpkins)] <- 0
ndd$darkgreen_vegetables[is.na(ndd$darkgreen_vegetables)] <- 0
ndd$other_vegetables[is.na(ndd$other_vegetables)] <- 0
ndd$fats[is.na(ndd$fats)] <- 0
ndd$bon_sel[is.na(ndd$bon_sel)] <- 0
ndd$bon_suc[is.na(ndd$bon_suc)] <- 0
ndd$artifical_juice[is.na(ndd$artifical_juice)] <- 0
ndd$natural_juice[is.na(ndd$natural_juice)] <- 0
ndd$soda[is.na(ndd$soda)] <- 0
ndd$zinc[is.na(ndd$zinc)] <- 0
ndd$iron[is.na(ndd$iron)] <- 0
ndd$vitamin_a[is.na(ndd$vitamin_a)] <- 0
ndd$home[is.na(ndd$home)] <- 3
```


```{r}
#Variable recoding

#combine all drink variables
ndd$drink_cat <- ifelse(ndd$drink_bottled == 1,1,
                (ifelse(ndd$drink_public == 1,2, 
                (ifelse(ndd$drink_spring == 1,3,
                (ifelse(ndd$drink_tab == 1,4,
                (ifelse(ndd$drink_tanker == 1,5, 
                (ifelse(ndd$drink_well == 1,6, 
                (ifelse(ndd$drink_other == 1,7, NA)))))))))))))


ndd$drink_cat <- factor(ndd$drink_cat, levels = c(1:7), 
                                      labels = c("Bottled","Public pump","Spring",
                                              "Tap","Tanker","Well","Other"))
label(ndd$drink_cat) <- "Drinking water source"

#combine all wash
ndd$wash_cat <- ifelse(ndd$wash_bottled == 1,1,
                (ifelse(ndd$wash_publis == 1,2, 
                (ifelse(ndd$wash_spring == 1,3,
                (ifelse(ndd$wash_tab == 1,4,
                (ifelse(ndd$wash_well == 1,5, 
                (ifelse(ndd$wash_tanker == 1,6, 
                (ifelse(ndd$wash_other == 1,7, NA)))))))))))))

ndd$wash_cat <- factor(ndd$wash_cat, levels = c(1:7), 
                       labels = c("Bottled","Public pump","Spring",
                                              "Tap","Tanker","Well","Other"))
label(ndd$wash_cat)<- "Bathing water source"
```


```{r}
#Labeling and recoding nutrition variables

ndd$micro_zinc <- ifelse(ndd$fish >= 1,1,
                  ifelse(ndd$milk >= 1,1,
                  ifelse(ndd$yogurt >= 1,1,
                  ifelse(ndd$flesh_meat >= 1,1,
                  ifelse(ndd$beans >= 1,1,
                  ifelse(ndd$pumpkins >= 1,1,
                  ifelse(ndd$zinc == 1,1, 0)))))))
ndd$micro_zinc<- factor(ndd$micro_zinc, levels = c(0,1),
                        labels = c("No","Yes"))
label(ndd$micro_zinc)<- "Zinc consumption"

ndd$micro_iron <- ifelse(ndd$beans >= 1,1,
                  ifelse(ndd$darkgreen_vegetables >= 1,1,
                  ifelse(ndd$tomato >= 1,1,
                  ifelse(ndd$flesh_meat >= 1,1,
                  ifelse(ndd$potatoes >= 1,1,
                  ifelse(ndd$eggs >= 1,1,
                  ifelse(ndd$iron == 1,1,
                  ifelse(ndd$chicken...89 >= 1,1, 0))))))))
ndd$micro_iron<- factor(ndd$micro_iron, levels = c(0,1),
                        labels = c("No","Yes"))
label(ndd$micro_iron)<- "Iron consumption"

ndd$micro_vitamind <- ifelse(ndd$milk >= 1,1,
                      ifelse(ndd$fish >= 1,1,
                      ifelse(ndd$eggs >= 1,1,
                      ifelse(ndd$chicken...89 >= 1,1, 0))))
ndd$micro_vitamind<- factor(ndd$micro_vitamind, levels = c(0,1),
                            labels = c("No","Yes"))
label(ndd$micro_vitamind)<- "Vitamin D consumption"

ndd$micro_vitamina <- ifelse(ndd$darkgreen_vegetables >= 1,1,
                      ifelse(ndd$pumpkins >= 1,1,
                      ifelse(ndd$mango >= 1,1,
                      ifelse(ndd$milk >= 1,1,
                      ifelse(ndd$chicken...89 >= 1,1,
                      ifelse(ndd$beans >= 1,1,
                      ifelse(ndd$tomato >= 1,1,
                      ifelse(ndd$fish >= 1,1,
                      ifelse(ndd$eggs >= 1,1,
                        ifelse(ndd$vitamin_a == 1,1, 0))))))))))
ndd$micro_vitamina<- factor(ndd$micro_vitamina, levels = c(0,1),
                            labels = c("No","Yes"))
label(ndd$micro_vitamina)<- "Vitamin A consumption"

#breastfeeding/nutrition
label(ndd$breastfeeding_now)<- "Currently breastfeeding"
ndd$breastfeeding_now<- factor(ndd$breastfeeding_now, levels = c(0,1),
                               labels = c("No","Yes"))

label(ndd$breastfeed_ever_yn_b)<- "Has child ever breastfed?"
ndd$breastfeed_ever_yn_b<- factor(ndd$breastfeed_ever_yn_b, levels = c(0,1),
                                  labels = c("No","Yes"))

label(ndd$mmd_b)<- "MMD"
label(ndd$hhds_b)<- "HHDS"
```


```{r}
#Labeling and recoding demographic variables
label(ndd$age_months_b) <- "Age (months)"

ndd$sex <- factor(ndd$sex, levels = c(1,2),
                  labels = c("Male","Female"))
label(ndd$sex) <- "Sex"


ndd$control_case_group<- factor(ndd$control_case_group, levels = c(0,1),
                                labels = c("Control","Case"))
label(ndd$control_case_group) <- "Study group"

label(ndd$maternal_age) <- "Caregiver age"


ndd$maternal_education<- ifelse(ndd$maternal_education<=2, 0,
                                ifelse(ndd$maternal_education>=3, 1, NA))
ndd$maternal_education[is.na(ndd$maternal_education)] = 0
ndd$maternal_education <- factor(ndd$maternal_education, levels = c(0,1), 
                                 labels = c("Primary education or less", "Secondary education or above"))
label(ndd$maternal_education) <- "Caregiver education"
```


```{r}
#Child growth variables
label(ndd$HAZ_b)<- "HAZ"
label(ndd$WAZ_b)<- "WAZ"
label(ndd$WHZ_b)<- "WHZ"
label(ndd$stunted_BL)<- "Stunted"
label(ndd$underweight_BL)<- "Underweight"
label(ndd$wasted_BL)<- "Wasted"
```


```{r}
#Labeling and recoding asset variables

ndd$hh_income<- ifelse(ndd$hh_income<= 2, 0,
                              ifelse(ndd$hh_income>= 3, 1, NA))
ndd$hh_income<- factor(ndd$hh_income, 
                            levels = c(0,1), labels = c("500-1500 Dola Ayisien", 
                                                        "1501+ Dola Ayisien"))
label(ndd$hh_income)<- "Household income"

ndd <- ndd %>%
    mutate(livestock = case_when(chicken...34 <= 2 ~ 1, 
                                 goats_pigs <= 2 ~ 1,
                                 TRUE ~ 0),
           home = case_when(home == 1 ~ 1,
                            TRUE ~ 0),
           telephone = case_when(telephone <= 2 ~ 1,
                                 TRUE ~ 0),
           tv = case_when(tv <= 2 ~ 1,
                          TRUE ~ 0),
           refrigerator = case_when(refrigerator <= 2 ~1,
                                    TRUE ~ 0),
           electricity = case_when(electricity <= 2 ~ 1,
                                   TRUE ~0),
           house_floor = case_when(house_floor >= 2 ~ 1,
                                   TRUE ~ 0),
           house_roof = case_when(house_roof == 2 ~ 1,
                                  TRUE ~ 0),
           toilet_type = case_when(toilet_type <= 3 ~ 1,
                                   TRUE ~ 0),
           )
#Factor version for all asset variables
ndd$F_home<- factor(ndd$home, levels = c(0:1),
                  labels = c("Rent or other","Own"))
label(ndd$F_home) <- "Home"
           
ndd$F_livestock<- factor(ndd$livestock, levels = c(0:1),
                       labels = c("Do not own", "Own"))
label(ndd$F_livestock)<- "Livestock"
view(ndd)

ndd$F_telephone<- factor(ndd$telephone, levels = c(0:1), 
                         labels = c("Do not own", "Own"))
label(ndd$F_telephone)<- "Cellphone"

ndd$F_tv<- factor(ndd$tv, levels = c(0,1),
                labels = c("Do not own","Own"))
label(ndd$F_tv)<- "TV"

ndd$F_refrigerator<- factor(ndd$refrigerator, levels = c(0,1),
                          labels = c("Do not own","Own"))
label(ndd$F_refrigerator)<- "Refrigerator"

ndd$F_electricity<- factor(ndd$electricity, levels = c(0,1),
                         labels = c("Never","Always/sometimes"))
label(ndd$F_electricity)<- "Electricity"

ndd$F_house_floor<- factor(ndd$house_floor, levels = c(0,1),
                         labels = c("Earth/rocks","Concrete/ceramic"))
label(ndd$F_house_floor)<- "Floor Type"

ndd$F_house_roof<- factor(ndd$house_roof, levels = c(0,1),
                        labels = c("Aluminum","Concrete"))
label(ndd$F_house_roof)<- "Roof type"

#living in hh
label(ndd$number_living_hh)<- "Number of people in household"

ndd$cat_num_liv_hh<- ifelse(ndd$number_living_hh<=5, 1,
                              ifelse(ndd$number_living_hh>=6, 0, NA))

#rooms in house
label(ndd$rooms_hh)<- "Household rooms"
```


```{r}
##Toilet variables
#toilet type
ndd$F_toilet_type<- factor(ndd$toilet_type, levels = c(0,1),
                         labels = c("Unimproved pit latrine/OD","Improved pit latrine/toilet"))
label(ndd$F_toilet_type)<- "Toilet type"

#toilet location
ndd$toilet_location<- ifelse(ndd$toilet_location <=2, 1,
                             ifelse(ndd$toilet_location ==3, 0, NA))
ndd$toilet_location<- factor(ndd$toilet_location, levels = c(0,1),
                             labels = c("On property","Elsewhere"))
label(ndd$toilet_location)<- "Toilet location"

#shared toilet
ndd$shared_toilet<- ifelse(ndd$shared_toilet == 0,0,
                    ifelse(ndd$shared_toilet == 1,1,
                    ifelse(ndd$shared_toilet == 2,0, NA)))
ndd$shared_toilet<- factor(ndd$shared_toilet, levels = c(0,1),
                           labels = c("No","Yes"))
label(ndd$shared_toilet)<- "Shared toilet"

#number of hh sharing toilet
label(ndd$toilet_number_ppl)<- "Number of households using same toilet"


```


```{r}
#Addressing NA values

library(VIM) 
library(mice) 
library(lattice)
install.packages("naniar")
library(naniar)

work_ndd<- data.frame(ndd$id, ndd$control_case_group, ndd$age_months_b, ndd$sex, ndd$maternal_education, ndd$maternal_age, ndd$WHZ_b, ndd$HAZ_b, ndd$WAZ_b, ndd$stunted_BL, ndd$underweight_BL, ndd$wasted_BL, ndd$tv, ndd$refrigerator, ndd$electricity, ndd$rooms_hh, ndd$house_roof, ndd$house_floor, ndd$hh_income, ndd$toilet_type, ndd$shared_toilet, ndd$drink_cat, ndd$wash_cat, ndd$breastfeed_ever_yn_b, ndd$breastfeeding_now, ndd$micro_iron, ndd$micro_vitamina, ndd$micro_zinc, ndd$micro_vitamind, ndd$mmd_b, ndd$hhds_b)
view(work_ndd)



is.na(work_ndd)

miss_case_summary(work_ndd)
miss_case_table(work_ndd)

miss_var_summary(work_ndd)
miss_var_table(work_ndd)
#All cases will be kept, NAs will be removed for analysis
```


```{r}



```


```{r }
#Assess continuous variables for normality/outliers

library(ggplot2)

ggplot(data = ndd, aes(x = age_months_b)) +
  geom_histogram() +
  labs(x = "Age (months)", title = "Histogram")

ggplot(data = ndd, aes(x = maternal_age)) +
  geom_histogram() +
  labs(x = "maternal_age", title = "Histogram")

ggplot(data = ndd, aes(x = number_living_hh)) +
  geom_histogram() +
  labs(x = "number in hh", title = "Histogram")

ggplot(data = ndd, aes(x = WHZ_b)) +
  geom_histogram() +
  labs(x = "WHZ", title = "Histogram")

ggplot(data = ndd, aes(x = HAZ_b)) +
  geom_histogram() +
  labs(x = "HAZ", title = "Histogram")

ggplot(data = ndd, aes(x = WAZ_b)) +
  geom_histogram() +
  labs(x = "WAZ", title = "Histogram")

ggplot(data = ndd, aes(x = hhds_b)) +
  geom_histogram() +
  labs(x = "HHDS", title = "Histogram")
```


```{r }
#Table 1 W/ p-values

library(table1)

pvalue <- function(x, ...) {
    # Construct vectors of data y, and groups (strata) g
    y <- unlist(x)
    g <- factor(rep(1:length(x), times=sapply(x, length)))
    if (is.numeric(y)) {
        # For numeric variables, perform a standard 2-sample t-test
        p <- t.test(y ~ g)$p.value
    } else {
        # For categorical variables, perform a chi-squared test of independence
        p <- chisq.test(table(y, g))$p.value
    }
    # Format the p-value, using an HTML entity for the less-than sign.
    # The initial empty string places the output on the line below the variable label.
    c("", sub("<", "&lt;", format.pval(p, digits=3, eps=0.001)))
}


demo_tbl1<- table1(~ age_months_b + sex + maternal_education + maternal_age + hh_income
                   |control_case_group, data = ndd, overall = F, extra.col= list(`P-value`=pvalue), na.rm= TRUE)
demo_tbl1

tbl1_assets<- table1(~ F_livestock + F_tv + F_refrigerator + F_electricity + 
                         F_house_floor + F_house_roof + number_living_hh
                     |control_case_group, data = ndd, overall = F, extra.col= list(`P-value`=pvalue), na.rm= TRUE)   
tbl1_assets

tbl1_WASH<- table1(~ toilet_type + shared_toilet + toilet_number_ppl + toilet_location
                   |control_case_group, data = ndd, overall = F, extra.col= list(`P-value`=pvalue), na.rm= TRUE)
tbl1_WASH


                        +  + breastfeeding_now + micro_iron + micro_vitamina + micro_vitamind + micro_zinc + mmd_b + hhds_b| control_case_group, data = ndd, overall = F, extra.col= list(`P-value`=pvalue), na.rm= TRUE)
demo_tbl1

```


```{r }


```


```{r }


```


```{r }

```
```{r}








```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
